<table class="table table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>Project</th>
            @foreach (var day in WeekDays)
            {
                <th>@day.ToString("ddd, dd-MM-yyyy")</th>
            }
        </tr>
    </thead>
    <tbody>
        @foreach (var proj in Projects)
        {
            <tr>
                <td>
                    <div>
                        <b>@proj.Name</b> <br />
                        <small class="text-muted">@proj.Type - @proj.Status</small>
                    </div>
                </td>
                @foreach (var day in WeekDays)
                {
                    <td>
                        @if (day.DayOfWeek == DayOfWeek.Saturday)
                        {
                            <!-- Thứ 7: chỉ cho phép 0 hoặc 4-Sáng -->
                            <select class="form-select" @bind="TimesheetData[(proj.Code, day)]">
                                <option value="0">0</option>
                                <option value="4">4 - Sáng</option>
                            </select>
                        }
                        else if (day.DayOfWeek == DayOfWeek.Sunday)
                        {
                            <!-- Chủ nhật: mặc định 0, disable -->
                            <select class="form-select" disabled>
                                <option selected value="0">0</option>
                            </select>
                        }
                        else
                        {
                            <!-- Ngày thường -->
                            <select class="form-select" @bind="TimesheetData[(proj.Code, day)]">
                                <option value="0">0</option>
                                <option value="4">4 - Sáng</option>
                                <option value="4">4 - Chiều</option>
                                <option value="8">8 - Cả ngày</option>
                            </select>
                        }
                    </td>
                }
            </tr>
        }
        <!-- Row Total -->
        <tr class="fw-bold">
            <td>Total</td>
            @foreach (var day in WeekDays)
            {
                <td>@TimesheetData.Where(x => x.Key.Item2 == day).Sum(x => x.Value)</td>
            }
        </tr>
    </tbody>
</table>

<button class="btn btn-primary mt-3" @onclick="Save">Save</button>

@code {
    [Parameter] public List<ProjectModel> Projects { get; set; } = new();
    [Parameter] public List<DateTime> WeekDays { get; set; } = new();

    private Dictionary<(string, DateTime), int> TimesheetData = new();

    protected override void OnParametersSet()
    {
        TimesheetData.Clear();
        foreach (var proj in Projects)
        {
            foreach (var day in WeekDays)
            {
                if (day.DayOfWeek == DayOfWeek.Sunday)
                {
                    // Chủ nhật luôn 0 (disable dropdown)
                    TimesheetData[(proj.Code, day)] = 0;
                }
                else
                {
                    // Thứ 7 và ngày thường mặc định 0
                    TimesheetData[(proj.Code, day)] = 0;
                }
            }
        }
    }

    private void Save()
    {
        // TODO: lưu vào DB
        Console.WriteLine("Saved timesheet");
        foreach (var kvp in TimesheetData)
        {
            Console.WriteLine($"{kvp.Key.Item1} - {kvp.Key.Item2:dd/MM/yyyy} : {kvp.Value}");
        }
    }
}
